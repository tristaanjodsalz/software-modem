use software_modem::ofdm::demodulator::{OFDMDemodulator, OFDMDemodulatorConfig};
use software_modem::qam::QAMOrder;

fn main() {
    #[rustfmt::skip]
    let modulated_symbol = vec![-2.039,11.934,-64.363,-22.497,165.219,-42.720,52.176,20.036,6.122,-6.066,22.128,10.992,-4.031,-28.765,-10.211,-2.883,-0.454,-7.050,6.655,17.462,-1.430,-35.378,-34.052,-24.146,2.198,-3.967,-1.581,2.114,-2.723,-5.238,-1.116,10.130,18.136,2.640,-1.843,-4.546,1.125,40.893,-5.506,-2.766,-2.900,7.829,-15.062,-4.745,-6.757,4.755,-8.892,14.388,28.258,54.105,9.278,26.111,-24.340,-47.553,15.929,-14.204,-2.573,-9.699,12.293,3.287,2.882,-3.681,6.669,-10.665,-9.664,-9.448,25.548,16.734,-6.466,-2.724,-47.411,-30.338,-9.720,-5.242,-15.164,-18.302,2.800,2.959,-12.952,-36.125,-21.322,-26.923,-12.178,-68.885,-5.201,69.820,23.434,37.074,12.152,14.497,-13.579,-17.551,-8.428,19.063,20.931,-9.672,-28.028,-1.492,25.610,7.222,-42.562,-0.196,-16.100,6.488,-2.699,1.587,-9.856,2.951,-4.107,14.940,19.368,14.439,-20.119,-24.704,-8.728,19.233,15.935,14.702,-15.529,-7.105,-21.575,-5.031,-7.976,10.777,-10.702,-14.037,-36.353,-2.599,-1.609,13.183,-61.095,-21.242];
    // let modulated_symbol = vec![1.5578203, 10.757554, -60.41084, -22.017548, 170.0, -42.44605, 54.674767, 22.390936, 6.2399883, -4.9697013, 22.430595, 17.925348, -2.8670907, -23.034523, -11.360638, 0.024665833, -3.071948, -7.734082, 3.0158787, 21.293457, 0.82842445, -35.719788, -33.072395, -19.85823, -0.14415121, -1.0148859, 1.0802565, 1.3617897, 1.0318756, -7.007739, 2.1753244, 15.374781, 21.054213, 0.07890889, -1.2171764, -3.3891459, -2.0, 41.081707, -4.085703, 0.47892523, -0.24726725, 6.605378, -11.310527, -4.8029222, -3.2976942, 6.129626, -5.986044, 17.46577, 33.94296, 56.904747, 10.276956, 26.332466, -21.798985, -45.932056, 16.227457, -11.979431, -5.4379044, -10.107577, 12.925878, 5.066286, 7.585412, -2.9996142, 5.774047, -8.335448, -6.82592, -9.922427, 26.371922, 19.215015, -6.0, -0.36616898, -44.328407, -32.542404, -11.508089, -6.3610272, -14.268342, -14.096208, 4.5239453, 3.1953726, -9.655043, -32.157936, -18.771591, -23.806992, -12.9909935, -65.67099, -4.8284245, 67.96052, 26.218727, 38.012096, 13.98769, 15.913272, -13.206813, -18.395777, -10.68873, 22.887703, 19.290443, -5.741539, -23.786112, -0.9140358, 27.256096, 6.191677, -42.0, 1.7305107, -14.260653, 9.6725445, -2.4846325, 4.7253504, -4.8517256, 0.97378147, -6.3591604, 13.709526, 19.001724, 14.6675, -20.099422, -25.363672, -8.301841, 18.045067, 17.798985, 13.69133, -17.373789, -6.1744323, -16.405634, -4.7908087, -8.799321, 11.967701, -5.9285583, -12.88035, -35.239815, -1.2977934, 1.5578203, 10.757554, -60.41084, -22.017548];

    let ofdm_demodulator = OFDMDemodulator::new(OFDMDemodulatorConfig {
        num_subcarriers: 64,
        cyclic_prefix_length: 4,
        pilot_subcarrier_every: 4,
        qam_order: QAMOrder::QAM16,
        fft: None,
    });

    // demodulate the symbol
    let mut demodulated_buffer = ofdm_demodulator.demodulate_symbol_from_buffer(&modulated_symbol);

    // strip trailing zeros
    demodulated_buffer.retain(|&x| x != 0);

    let demodulated_data = String::from_utf8(demodulated_buffer).unwrap();

    println!("Demodulated Data: {}", demodulated_data);
}
